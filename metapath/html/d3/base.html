@require(htmlbase)

<!DOCTYPE html>
<head>
<title>d3 Visualisation</title>
<meta charset="utf-8">


<link rel="stylesheet" type="text/css" href="foundation.min.css">

<link rel="stylesheet" type="text/css" href="file://@htmlbase/css/foundation.min.css">
<link rel="stylesheet" type="text/css" href="file://@htmlbase/css/normalize.css">

<style>
html, body {
    margin:0; padding:0;
    -webkit-user-select: none;
    pointer-events: all;
    background-color:#fff;    
    }

svg {
    margin:0; padding:0;
}

</style>

@def styles():
@end
@styles()

<script src="d3.min.js"></script>
<script src="file://@htmlbase/js/d3.min.js"></script>
<script src="file://@htmlbase/js/figures.js"></script>


</head>
<body>

<script>

    d3.unique = function(array, f) {
      return d3.nest().key(f || String).entries(array).map(function(d) { return d.key; });
    };

    function delegateLink(url){
        QtWebView.delegateLink(url);
    }
    
    function getWindowSize(){
        var w = window,
            d = document,
            e = d.documentElement,
            g = d.getElementsByTagName('body')[0],
            x = w.innerWidth || e.clientWidth || g.clientWidth,
            y = w.innerHeight|| e.clientHeight|| g.clientHeight;
        return [x,y]
    }
    
    function getMaxFigureSize(){
        xy = getWindowSize()
        return [ xy[0]-10, xy[1]-10 ]        
    }
    
    function getElementSize(id){
        if (id == 'body'){
            return getMaxFigureSize()
        } else {
            xy = [        
                d3.select(id)[0][0].offsetWidth,
                d3.select(id)[0][0].offsetHeight,
                ];
            if (xy[1] == 0) { xy[1] = xy[0]*2/3; } //800*600
            return xy
        }
    }
    
    
    function resizeFigureToWindow(){
        var windowxy = getMaxFigureSize()
        d3.select("svg")
            .attr("width", windowxy[0]).attr("height", windowxy[1]);
    }
    
</script>

@def script():
@end
@script()

@def generate():
@end
@generate()

</body>